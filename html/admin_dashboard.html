<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard</title>
  <link rel="stylesheet" href="../css/admin_dashboard.css"/> 
  <link rel="stylesheet" href="../css/landing_page.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">



  <style>
.approve-btn {
  background: #22c55e;
  color: #fff;
  border: none;
  border-radius: 5px;
  padding: 6px 14px;
  margin-right: 6px;
  cursor: pointer;
  font-weight: 500;
}
.decline-btn {
  background: #ef4444;
  color: #fff;
  border: none;
  border-radius: 5px;
  padding: 6px 14px;
  cursor: pointer;
  font-weight: 500;
}
.approve-btn:hover { background: #16a34a; }
.decline-btn:hover { background: #b91c1c; }
</style>
</head>
<body>

  <div class="container">
        <header class="header-nav-bar"></header>

    <aside class="sidebar">
      <h2>Admin Panel</h2>
      <nav>
        <ul>
          <li class="active">üè† Dashboard</li>
          <li>üè´ Universities</li>
          <li>üë§ Users</li>
          <li>‚≠ê Reviews</li>
          <li>‚öôÔ∏è Settings</li>
        </ul>
      </nav>
    </aside>

    <main class="main-content">
      <section class="stats">
        <div class="card">
          <h3>Total Universities</h3>
          <p>15</p>
        </div>
        <div class="card">
          <h3>Active Users</h3>
          <p>235</p>
        </div>
        <div class="card">
          <h3>New Reviews</h3>
          <p>42</p>
        </div>
      </section>

      <section class="recent-activity">
        <h2>Recent Activity</h2>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>University</th>
                <th>Status</th>
                <th>Last Updated</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="universities-tbody">
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <script>
document.addEventListener("DOMContentLoaded", function () {
  const tbody = document.getElementById('universities-tbody');

  function loadUniversities() {
    fetch('/api/admin/universities')
      .then(res => res.json())
      .then(universities => {
        tbody.innerHTML = '';
        universities.forEach(u => {
          const tr = document.createElement('tr');
          const status = u.approved === true
            ? '<span class="status published">Published</span>'
            : '<span class="status draft">Pending</span>';
          const date = u.createdAt ? new Date(u.createdAt).toISOString().slice(0,10) : '';
          tr.innerHTML = `
            <td>${u.name}</td>
            <td>${status}</td>
            <td>${date}</td>
            <td>
              <button class="approve-btn" data-id="${u._id}">Approve</button>
              <button class="decline-btn" data-id="${u._id}">Decline</button>
            </td>
          `;
          tbody.appendChild(tr);
        });

        document.querySelectorAll('.approve-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            fetch(`/api/admin/universities/${id}/approve`, {
              method: 'PATCH',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ approved: true })
            }).then(() => loadUniversities());
          });
        });
        document.querySelectorAll('.decline-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            const id = this.getAttribute('data-id');
            fetch(`/api/admin/universities/${id}/approve`, {
              method: 'PATCH',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ approved: false })
            }).then(() => loadUniversities());
          });
        });
      })
      .catch(err => {
        tbody.innerHTML = '<tr><td colspan="4" style="color:red;">Failed to load universities.</td></tr>';
        console.error(err);
      });
  }
  loadUniversities();
});
</script>
  <script src="../js/insert_nav_bar.js" defer></script>

</body>
</html>
